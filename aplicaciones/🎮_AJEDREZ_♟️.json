{
  "id": "program-ajedrez-silen-v2",
  "type": "executable",
  "title": "üéÆ AJEDREZ ‚ôüÔ∏è",
  "parentId": "folder-1766530794088863",
  "content": {
    "nodes": [
      {
        "id": "node-start-chess",
        "type": "start",
        "x": 50,
        "y": 50,
        "inputs": [],
        "outputs": [
          "out"
        ],
        "values": {},
        "uiFlags": {}
      },
      {
        "id": "node-chess-engine",
        "type": "chess-silenos-pvs",
        "x": 350,
        "y": 80,
        "inputs": [
          "open"
        ],
        "outputs": [
          "game_end"
        ],
        "values": {
          "titulo": "Ajedrez: Visi√≥n y Estrategia"
        },
        "uiFlags": {
          "titulo": false
        }
      }
    ],
    "connections": [
      {
        "fromNode": "node-start-chess",
        "fromPort": "out",
        "toNode": "node-chess-engine",
        "toPort": "open"
      }
    ],
    "panX": 0,
    "panY": 0,
    "scale": 1,
    "embeddedModules": [
      {
        "id": "chess-silenos-pvs",
        "title": "Ajedrez (Z-H-F)",
        "color": "#475569",
        "inputs": [
          "open"
        ],
        "outputs": [
          "game_end"
        ],
        "fields": [
          {
            "name": "titulo",
            "type": "text",
            "value": "Ajedrez Silenos"
          }
        ],
        "code": "\nconst winId = 'chess-pvs-window';\nconst existing = document.getElementById(winId);\nif (existing) { existing.remove(); return; }\n\n// --- VARIABLES DE ESTADO (Z-N) ---\nlet board = [\n    ['r','n','b','q','k','b','n','r'],\n    ['p','p','p','p','p','p','p','p'],\n    ['','','','','','','',''],\n    ['','','','','','','',''],\n    ['','','','','','','',''],\n    ['','','','','','','',''],\n    ['P','P','P','P','P','P','P','P'],\n    ['R','N','B','Q','K','B','N','R']\n];\n\nconst pieceIcons = {\n    'r': '‚ôú', 'n': '‚ôû', 'b': '‚ôù', 'q': '‚ôõ', 'k': '‚ôö', 'p': '‚ôü',\n    'R': '‚ôñ', 'N': '‚ôò', 'B': '‚ôó', 'Q': '‚ôï', 'K': '‚ôî', 'P': '‚ôô'\n};\n\nlet selected = null;\nlet turn = 'white';\nlet gameMode = 'PvP'; // PvP o PvS (System)\nlet isSystemThinking = false;\n\n// --- INTERFAZ (F-D) ---\nconst win = document.createElement('div');\nwin.id = winId;\nwin.style.cssText = `\n    position: absolute; top: 60px; left: 180px; width: 400px;\n    z-index: 9999; display: flex; flex-direction: column;\n    background: #e0e5ec; border-radius: 28px;\n    box-shadow: 12px 12px 24px #b8b9be, -12px -12px 24px #ffffff;\n    overflow: hidden; font-family: sans-serif;\n`;\n\nconst header = document.createElement('div');\nheader.style.cssText = `\n    padding: 15px; display: flex; justify-content: space-between;\n    align-items: center; cursor: grab; background: #e0e5ec;\n    border-bottom: 1px solid rgba(0,0,0,0.05);\n`;\nheader.innerHTML = `\n    <span style=\"font-weight:900; color:#475569; font-size:0.75rem; letter-spacing:1px;\">‚ôüÔ∏è ${ctx.fields.titulo || 'AJEDREZ'}</span>\n    <button id=\"close-${winId}\" style=\"border:none; background:transparent; cursor:pointer; font-size:1.2rem; color:#888;\">√ó</button>\n`;\n\nconst body = document.createElement('div');\nbody.style.cssText = `padding: 20px; display: flex; flex-direction: column; align-items: center; gap: 15px;`;\n\n// SELECTOR DE MODO\nconst modeSelector = document.createElement('div');\nmodeSelector.style.cssText = `display: flex; background: rgba(0,0,0,0.03); padding: 4px; border-radius: 12px; width: 100%;`;\n\nconst createModeBtn = (label, active, mode) => {\n    const btn = document.createElement('button');\n    btn.innerText = label;\n    btn.style.cssText = `flex: 1; border: none; padding: 8px; border-radius: 10px; font-size: 0.6rem; font-weight: bold; cursor: pointer; transition: 0.3s; background: ${active ? '#475569' : 'transparent'}; color: ${active ? '#fff' : '#718096'};`;\n    btn.onclick = () => {\n        gameMode = mode;\n        [pvpBtn, pvsBtn].forEach(b => { b.style.background = 'transparent'; b.style.color = '#718096'; });\n        btn.style.background = '#475569'; btn.style.color = '#fff';\n        ctx.log(\"Modo cambiado a: \" + label);\n    };\n    return btn;\n};\n\nconst pvpBtn = createModeBtn('PLAYER VS PLAYER', true, 'PvP');\nconst pvsBtn = createModeBtn('PLAYER VS SYSTEM', false, 'PvS');\nmodeSelector.append(pvpBtn, pvsBtn);\n\nconst info = document.createElement('div');\ninfo.style.cssText = `font-size: 0.65rem; font-weight: 800; color: #718096; text-transform: uppercase;`;\ninfo.innerText = \"TURNO: BLANCAS\";\n\nconst boardEl = document.createElement('div');\nboardEl.style.cssText = `\n    display: grid; grid-template-columns: repeat(8, 42px);\n    grid-template-rows: repeat(8, 42px); border: 4px solid #a3b1c6;\n    border-radius: 12px; box-shadow: inset 4px 4px 8px #b8b9be;\n`;\n\n// --- L√ìGICA DE JUEGO ---\n\nconst drawBoard = () => {\n    boardEl.innerHTML = '';\n    for (let r = 0; r < 8; r++) {\n        for (let c = 0; c < 8; c++) {\n            const sq = document.createElement('div');\n            const isDark = (r + c) % 2 === 1;\n            sq.style.cssText = `\n                width: 42px; height: 42px; display: flex;\n                align-items: center; justify-content: center;\n                font-size: 1.8rem; cursor: pointer; transition: 0.2s;\n                background: ${isDark ? '#a3b1c6' : '#e0e5ec'};\n                ${selected && selected.r === r && selected.c === c ? 'background: #cbd5e0; box-shadow: inset 2px 2px 5px #b8b9be;' : ''}\n            `;\n            \n            const piece = board[r][c];\n            if (piece) {\n                sq.innerText = pieceIcons[piece];\n                sq.style.color = piece === piece.toUpperCase() ? '#fff' : '#1e1e1e';\n                if(piece === piece.toUpperCase()) sq.style.filter = 'drop-shadow(1px 1px 1px rgba(0,0,0,0.5))';\n            }\n\n            sq.onclick = () => !isSystemThinking && handleSquareClick(r, c);\n            boardEl.appendChild(sq);\n        }\n    }\n};\n\nconst handleSquareClick = (r, c) => {\n    const piece = board[r][c];\n    const isWhite = piece && piece === piece.toUpperCase();\n\n    if (selected) {\n        if (selected.r === r && selected.c === c) {\n            selected = null;\n        } else {\n            // Mover\n            board[r][c] = board[selected.r][selected.c];\n            board[selected.r][selected.c] = '';\n            selected = null;\n            turn = turn === 'white' ? 'black' : 'white';\n            updateUI();\n\n            // Si es contra el sistema, ejecutar turno de la m√°quina\n            if (gameMode === 'PvS' && turn === 'black') {\n                makeSystemMove();\n            }\n        }\n        drawBoard();\n    } else {\n        if (piece && ((turn === 'white' && isWhite) || (turn === 'black' && !isWhite))) {\n            selected = {r, c};\n            drawBoard();\n        }\n    }\n};\n\nconst updateUI = () => {\n    info.innerText = `TURNO: ${turn === 'white' ? 'BLANCAS' : 'NEGRAS'}`;\n    info.style.color = turn === 'white' ? '#475569' : '#10b981';\n};\n\n// L√ìGICA DEL SISTEMA (IA SIMPLE)\nconst makeSystemMove = () => {\n    isSystemThinking = true;\n    info.innerText = \"SISTEMA PENSANDO...\";\n    \n    setTimeout(() => {\n        // 1. Encontrar todas las piezas negras\n        let blackPieces = [];\n        for(let r=0; r<8; r++){\n            for(let c=0; c<8; c++){\n                if(board[r][c] && board[r][c] === board[r][c].toLowerCase()) blackPieces.push({r, c});\n            }\n        }\n\n        // 2. Buscar un movimiento (Estrategia: Aleatoria pero intenta capturar)\n        let moved = false;\n        blackPieces.sort(() => Math.random() - 0.5); // Desordenar\n\n        for (let p of blackPieces) {\n            // Movimientos simplificados: buscar espacios vac√≠os o piezas blancas cerca\n            let targets = [\n                {r: p.r+1, c: p.c}, {r: p.r+1, c: p.c+1}, {r: p.r+1, c: p.c-1}, \n                {r: p.r+2, c: p.c}, {r: p.r, c: p.c+1}, {r: p.r, c: p.c-1}\n            ].filter(t => t.r >= 0 && t.r < 8 && t.c >= 0 && t.c < 8);\n\n            for (let t of targets) {\n                const targetPiece = board[t.r][t.c];\n                // Solo mover si est√° vac√≠o o es blanca\n                if (!targetPiece || targetPiece === targetPiece.toUpperCase()) {\n                    board[t.r][t.c] = board[p.r][p.c];\n                    board[p.r][p.c] = '';\n                    moved = true;\n                    break;\n                }\n            }\n            if (moved) break;\n        }\n\n        turn = 'white';\n        isSystemThinking = false;\n        updateUI();\n        drawBoard();\n        ctx.log(\"ü§ñ Sistema ha movido.\");\n    }, 1200);\n};\n\nconst btnReset = document.createElement('button');\nbtnReset.innerText = \"REINICIAR TABLERO\";\nbtnReset.style.cssText = `\n    width: 100%; padding: 12px; border: none; border-radius: 15px;\n    background: #e0e5ec; color: #475569; font-weight: 900;\n    cursor: pointer; box-shadow: 6px 6px 12px #b8b9be, -4px -4px 8px #ffffff;\n    font-size: 0.65rem; transition: 0.2s;\n`;\nbtnReset.onclick = () => { \n    board = [\n        ['r','n','b','q','k','b','n','r'], ['p','p','p','p','p','p','p','p'],\n        ['','','','','','','',''], ['','','','','','','',''],\n        ['','','','','','','',''], ['','','','','','','',''],\n        ['P','P','P','P','P','P','P','P'], ['R','N','B','Q','K','B','N','R']\n    ];\n    turn = 'white'; updateUI(); drawBoard();\n};\n\nbody.append(modeSelector, info, boardEl, btnReset);\nwin.append(header, body);\ndocument.body.appendChild(win);\n\n// ARRASTRE\nlet dragging = false, offset = {x:0, y:0};\nheader.onmousedown = (e) => {\n    dragging = true;\n    offset.x = e.clientX - win.offsetLeft;\n    offset.y = e.clientY - win.offsetTop;\n    win.style.zIndex = 10000;\n};\nwindow.addEventListener('mousemove', (e) => {\n    if (!dragging) return;\n    win.style.left = (e.clientX - offset.x) + 'px';\n    win.style.top = (e.clientY - offset.y) + 'px';\n});\nwindow.addEventListener('mouseup', () => dragging = false);\n\ndocument.getElementById(`close-${winId}`).onclick = () => {\n    win.remove();\n};\n\ndrawBoard();\nreturn \"Ajedrez PvP/PvS Iniciado\";\n"
      }
    ]
  },
  "x": 0,
  "y": 0,
  "icon": "swords",
  "color": "text-slate-700"
}