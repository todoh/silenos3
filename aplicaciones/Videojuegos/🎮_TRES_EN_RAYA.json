{
  "id": "program-1766530918250642",
  "type": "executable",
  "title": "üéÆ TRES EN RAYA",
  "parentId": "desktop",
  "content": {
    "nodes": [
      {
        "id": "node-program-1766525535469736-0",
        "type": "start",
        "x": 50,
        "y": 50,
        "inputs": [],
        "outputs": [
          "out"
        ],
        "values": {},
        "uiFlags": {}
      },
      {
        "id": "node-program-1766525535469736-21",
        "type": "tictactoe-pro-v4",
        "x": 343,
        "y": -75,
        "inputs": [
          "open"
        ],
        "outputs": [
          "resultado"
        ],
        "values": {
          "titulo": "3 en Raya"
        },
        "uiFlags": {
          "titulo": false
        }
      }
    ],
    "connections": [
      {
        "fromNode": "node-program-1766525535469736-0",
        "fromPort": "out",
        "toNode": "node-program-1766525535469736-21",
        "toPort": "open"
      }
    ],
    "panX": 0,
    "panY": 0,
    "scale": 1,
    "embeddedModules": [
      {
        "id": "tictactoe-pro-v4",
        "title": "3 en Raya (Interface Pro)",
        "color": "#3b82f6",
        "inputs": [
          "open"
        ],
        "outputs": [
          "resultado"
        ],
        "fields": [
          {
            "name": "titulo",
            "type": "text",
            "value": "3 en Raya"
          }
        ],
        "code": "\n// --- CONFIGURACI√ìN DE VENTANA ---\nconst winId = 'ttt-v4-window';\nconst existing = document.getElementById(winId);\nif (existing) { existing.remove(); return; }\n\n// --- L√ìGICA Y ESTADO ---\nlet board = Array(9).fill(null);\nlet isXNext = true;\nlet gameActive = true;\nlet modo = 'PVP'; // 'PVP' o 'PVS'\n\n// --- INTERFAZ DOM ---\nconst win = document.createElement('div');\nwin.id = winId;\nwin.style.cssText = `\n    position: absolute; top: 150px; left: 150px; width: 300px;\n    z-index: 9999; display: flex; flex-direction: column;\n    background: #e0e5ec; border-radius: 28px;\n    box-shadow: 8px 8px 20px rgba(0,0,0,0.08), -2px -2px 10px rgba(255,255,255,0.2);\n    user-select: none; overflow: hidden; font-family: sans-serif;\n`;\n\nconst header = document.createElement('div');\nheader.style.cssText = `\n    padding: 15px; display: flex; justify-content: space-between;\n    align-items: center; cursor: grab; border-bottom: 1px solid rgba(0,0,0,0.05);\n`;\nheader.innerHTML = `\n    <span style=\"font-weight:900; color:#3b82f6; font-size:0.75rem; letter-spacing:1px;\">üïπÔ∏è ${ctx.fields.titulo || 'GAME'}</span>\n    <button id=\"close-${winId}\" style=\"border:none; background:transparent; cursor:pointer; font-size:1.2rem; color:#888;\">√ó</button>\n`;\n\nconst body = document.createElement('div');\nbody.style.cssText = `padding: 20px; display: flex; flex-direction: column; gap: 15px; align-items: center;`;\n\n// SELECTOR DE MODO INTEGRADO\nconst modeSelector = document.createElement('div');\nmodeSelector.style.cssText = `\n    display: flex; background: rgba(0,0,0,0.03); padding: 4px; \n    border-radius: 12px; width: 100%; justify-content: space-between;\n`;\n\nconst createModeBtn = (label, active) => {\n    const btn = document.createElement('button');\n    btn.innerText = label;\n    btn.style.cssText = `\n        flex: 1; border: none; padding: 6px; border-radius: 10px; \n        font-size: 0.65rem; font-weight: bold; cursor: pointer; transition: 0.3s;\n        background: ${active ? '#3b82f6' : 'transparent'}; \n        color: ${active ? '#fff' : '#718096'};\n    `;\n    return btn;\n};\n\nconst pvpBtn = createModeBtn('PLAYER VS PLAYER', true);\nconst pvsBtn = createModeBtn('PLAYER VS SYSTEM', false);\n\nmodeSelector.append(pvpBtn, pvsBtn);\n\nconst statusText = document.createElement('div');\nstatusText.innerText = \"TURNO: X\";\nstatusText.style.cssText = \"font-size: 0.65rem; font-weight: 800; color: #718096; text-transform: uppercase;\";\n\nconst grid = document.createElement('div');\ngrid.style.cssText = `display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; width: 100%;`;\n\n// ESTILOS DE CELDAS (SOMBREADO SUAVE)\nconst style = document.createElement('style');\nstyle.innerHTML = `\n    .ttt-cell {\n        width: 75px; height: 75px; border: none; border-radius: 20px;\n        background: #e0e5ec; font-size: 1.5rem; font-weight: 900;\n        box-shadow: 4px 4px 8px rgba(0,0,0,0.06); cursor: pointer;\n        transition: 0.2s; color: #4a5568;\n    }\n    .ttt-cell:active { transform: scale(0.95); }\n    .ttt-cell.filled { box-shadow: inset 2px 2px 5px rgba(0,0,0,0.05); cursor: default; }\n`;\n\nconst cells = [];\n\nconst checkWinner = () => {\n    const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];\n    for (let [a,b,c] of lines) {\n        if (board[a] && board[a] === board[b] && board[a] === board[c]) return board[a];\n    }\n    return board.includes(null) ? null : 'E';\n};\n\nconst handleMove = (i) => {\n    if (!gameActive || board[i]) return;\n\n    board[i] = isXNext ? 'X' : 'O';\n    cells[i].innerText = board[i];\n    cells[i].classList.add('filled');\n    cells[i].style.color = isXNext ? '#3b82f6' : '#ef4444';\n\n    const result = checkWinner();\n    if (result) {\n        gameActive = false;\n        statusText.innerText = result === 'E' ? \"¬°EMPATE!\" : `GANADOR: ${result}`;\n        statusText.style.color = result === 'X' ? '#3b82f6' : (result === 'O' ? '#ef4444' : '#718096');\n        return;\n    }\n\n    isXNext = !isXNext;\n    statusText.innerText = `TURNO: ${isXNext ? 'X' : 'O'}`;\n\n    if (modo === 'PVS' && !isXNext && gameActive) {\n        setTimeout(systemMove, 500);\n    }\n};\n\nconst systemMove = () => {\n    const available = board.map((v, i) => v === null ? i : null).filter(v => v !== null);\n    if (available.length > 0) {\n        const move = available[Math.floor(Math.random() * available.length)];\n        handleMove(move);\n    }\n};\n\nconst resetGame = () => {\n    board = Array(9).fill(null);\n    gameActive = true;\n    isXNext = true;\n    statusText.innerText = \"TURNO: X\";\n    statusText.style.color = \"#718096\";\n    cells.forEach(c => { c.innerText = ''; c.classList.remove('filled'); });\n};\n\n// EVENTOS DE BOTONES DE MODO\npvpBtn.onclick = () => {\n    modo = 'PVP';\n    pvpBtn.style.background = '#3b82f6'; pvpBtn.style.color = '#fff';\n    pvsBtn.style.background = 'transparent'; pvsBtn.style.color = '#718096';\n    resetGame();\n};\npvsBtn.onclick = () => {\n    modo = 'PVS';\n    pvsBtn.style.background = '#3b82f6'; pvsBtn.style.color = '#fff';\n    pvpBtn.style.background = 'transparent'; pvpBtn.style.color = '#718096';\n    resetGame();\n};\n\n// CREAR TABLERO\nfor (let i = 0; i < 9; i++) {\n    const btn = document.createElement('button');\n    btn.className = 'ttt-cell';\n    btn.onclick = () => {\n        if (modo === 'PVS' && !isXNext) return;\n        handleMove(i);\n    };\n    cells.push(btn);\n    grid.appendChild(btn);\n}\n\nbody.append(modeSelector, statusText, grid);\nwin.append(style, header, body);\ndocument.body.appendChild(win);\n\n// --- DRAG LOGIC (MEJORADA) ---\nlet dragging = false, offset = {x:0, y:0};\nheader.onmousedown = (e) => {\n    dragging = true;\n    offset.x = e.clientX - win.offsetLeft;\n    offset.y = e.clientY - win.offsetTop;\n    win.style.zIndex = 10000;\n};\nwindow.addEventListener('mousemove', (e) => {\n    if (!dragging) return;\n    win.style.left = (e.clientX - offset.x) + 'px';\n    win.style.top = (e.clientY - offset.y) + 'px';\n});\nwindow.addEventListener('mouseup', () => dragging = false);\n\ndocument.getElementById(`close-${winId}`).onclick = () => win.remove();\n\nreturn \"üéÆ 3 en Raya listo.\";\n",
        "_isExternal": false
      },
      {
        "id": "custom-self-exporter-exec-v22",
        "title": "Crear Ejecutable v2.2 (Autoportable)",
        "color": "#ef4444",
        "inputs": [
          "exec"
        ],
        "outputs": [],
        "fields": [
          {
            "name": "filename",
            "type": "text",
            "placeholder": "NombreApp"
          }
        ],
        "code": "\n// --- CREAR EJECUTABLE V2.2 (AUTOPORTABLE) ---\nconst name = ctx.fields.filename || \"App_\" + Date.now();\nctx.log(`‚ö° Procesando ejecutable autoportable: ${name}...`);\n\ntry {\n    // 1. Serializar el grafo actual\n    const fullData = ctx.graph.serialize();\n\n    // 2. EXTRAER DEFINICIONES DE M√ìDULOS USADOS (La \"Portabilidad\")\n    // Identificamos qu√© tipos de nodos hay en el grafo\n    const usedTypes = new Set(fullData.nodes.map(n => n.type));\n    \n    // Filtramos los m√≥dulos personalizados que existen en el sistema y que est√°n en el grafo\n    const embeddedModules = ProgrammerManager.customModules.filter(m => usedTypes.has(m.id));\n    \n    if (embeddedModules.length > 0) {\n        ctx.log(`üì¶ Embebiendo ${embeddedModules.length} m√≥dulos personalizados...`);\n    }\n\n    // 3. CIRUG√çA: Extirpar este mismo nodo exportador para evitar bucles\n    const cleanNodes = fullData.nodes.filter(n => n.id !== ctx.nodeId);\n    const cleanConns = fullData.connections.filter(c => \n        c.fromNode !== ctx.nodeId && c.toNode !== ctx.nodeId\n    );\n\n    // 4. Reconstruir el objeto con las definiciones embebidas\n    const finalContent = {\n        ...fullData,\n        nodes: cleanNodes,\n        connections: cleanConns,\n        embeddedModules: embeddedModules, // <-- AQU√ç VA LA MAGIA\n        panX: 0, panY: 0, scale: 1\n    };\n\n    // 5. Crear el archivo en el Sistema\n    if (typeof FileSystem !== 'undefined') {\n        const newProg = FileSystem.createProgram(name, 'desktop');\n        \n        newProg.type = 'executable'; \n        newProg.icon = 'zap'; \n        newProg.color = 'text-yellow-500';\n        newProg.content = finalContent;\n        \n        FileSystem.save();\n        if (typeof refreshSystemViews === 'function') refreshSystemViews();\n        \n        ctx.log(`‚úÖ ¬°√âxito! \"${name}\" es ahora autoportable.`);\n    } else {\n        ctx.log(\"‚ùå Error: No se encuentra el Sistema de Archivos.\");\n    }\n} catch (e) {\n    ctx.log(\"‚ùå Error: \" + e.message);\n}\n",
        "_isExternal": false
      }
    ]
  },
  "x": 1164,
  "y": 546,
  "icon": "zap",
  "color": "text-yellow-500"
}