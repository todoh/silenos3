{
  "id": "program-176653089204914",
  "type": "executable",
  "title": "üéÆ SNAKE üêç",
  "parentId": "desktop",
  "content": {
    "nodes": [
      {
        "id": "node-program-1766526435022812-0",
        "type": "start",
        "x": 50,
        "y": 50,
        "inputs": [],
        "outputs": [
          "out"
        ],
        "values": {},
        "uiFlags": {}
      },
      {
        "id": "node-program-1766526435022812-6",
        "type": "snake-silenos-v4",
        "x": 459,
        "y": 83,
        "inputs": [
          "open"
        ],
        "outputs": [
          "score"
        ],
        "values": {
          "titulo": "Snake Pro"
        },
        "uiFlags": {
          "titulo": false
        }
      }
    ],
    "connections": [
      {
        "fromNode": "node-program-1766526435022812-0",
        "fromPort": "out",
        "toNode": "node-program-1766526435022812-6",
        "toPort": "open"
      }
    ],
    "panX": 0,
    "panY": 0,
    "scale": 1,
    "embeddedModules": [
      {
        "id": "snake-silenos-v4",
        "title": "Snake Pro (Interface)",
        "color": "#10b981",
        "inputs": [
          "open"
        ],
        "outputs": [
          "score"
        ],
        "fields": [
          {
            "name": "titulo",
            "type": "text",
            "value": "Snake Pro"
          }
        ],
        "code": "\nconst winId = 'snake-v4-window';\nconst existing = document.getElementById(winId);\nif (existing) { existing.remove(); return; }\n\n// --- VARIABLES DE ESTADO ---\nlet snake = [{x: 10, y: 10}];\nlet food = {x: 5, y: 5};\nlet dx = 0, dy = 0;\nlet nextDx = 0, nextDy = 0;\nlet score = 0;\nlet level = 1;\nlet speed = 150;\nlet gameActive = false;\nlet loop = null;\nlet currentDifficulty = 'NORMAL';\n\n// --- INTERFAZ ---\nconst win = document.createElement('div');\nwin.id = winId;\nwin.style.cssText = `\n    position: absolute; top: 120px; left: 120px; width: 320px;\n    z-index: 9999; display: flex; flex-direction: column;\n    background: #e0e5ec; border-radius: 28px;\n    box-shadow: 8px 8px 20px rgba(0,0,0,0.08), -2px -2px 10px rgba(255,255,255,0.2);\n    user-select: none; overflow: hidden; font-family: sans-serif;\n`;\n\nconst header = document.createElement('div');\nheader.style.cssText = `\n    padding: 15px; display: flex; justify-content: space-between;\n    align-items: center; cursor: grab; border-bottom: 1px solid rgba(0,0,0,0.05);\n`;\nheader.innerHTML = `\n    <span style=\"font-weight:900; color:#10b981; font-size:0.75rem; letter-spacing:1px;\">üêç ${ctx.fields.titulo || 'SNAKE'}</span>\n    <button id=\"close-${winId}\" style=\"border:none; background:transparent; cursor:pointer; font-size:1.2rem; color:#888;\">√ó</button>\n`;\n\nconst body = document.createElement('div');\nbody.style.cssText = `padding: 20px; display: flex; flex-direction: column; gap: 15px; align-items: center;`;\n\n// SELECTOR DE DIFICULTAD INTEGRADO\nconst diffSelector = document.createElement('div');\ndiffSelector.style.cssText = `display: flex; background: rgba(0,0,0,0.03); padding: 4px; border-radius: 12px; width: 100%;`;\n\nconst createDiffBtn = (label, active) => {\n    const btn = document.createElement('button');\n    btn.innerText = label;\n    btn.style.cssText = `flex: 1; border: none; padding: 6px; border-radius: 10px; font-size: 0.6rem; font-weight: bold; cursor: pointer; transition: 0.3s; background: ${active ? '#10b981' : 'transparent'}; color: ${active ? '#fff' : '#718096'};`;\n    return btn;\n};\n\nconst easyBtn = createDiffBtn('EASY', false);\nconst normBtn = createDiffBtn('NORMAL', true);\nconst hardBtn = createDiffBtn('HARD', false);\n\ndiffSelector.append(easyBtn, normBtn, hardBtn);\n\nconst stats = document.createElement('div');\nstats.style.cssText = `display: flex; justify-content: space-between; width: 100%; font-size: 0.65rem; font-weight: 800; color: #718096;`;\nstats.innerHTML = `<span id=\"sk-score\">PUNTOS: 0</span><span id=\"sk-level\">NIVEL: 1</span>`;\n\nconst canvas = document.createElement('canvas');\ncanvas.width = 280; canvas.height = 280;\ncanvas.style.cssText = `background: #d1d9e6; border-radius: 18px; box-shadow: inset 4px 4px 8px rgba(0,0,0,0.05);`;\nconst g = canvas.getContext('2d');\n\nconst btnStart = document.createElement('button');\nbtnStart.innerText = \"START GAME\";\nbtnStart.style.cssText = `width: 100%; padding: 12px; border: none; border-radius: 15px; background: #e0e5ec; color: #10b981; font-weight: 900; cursor: pointer; box-shadow: 4px 4px 10px rgba(0,0,0,0.08);`;\n\n// --- LOGICA ---\nconst draw = () => {\n    g.clearRect(0,0,280,280);\n    // Comida\n    g.fillStyle = '#ef4444';\n    g.fillRect(food.x * 14 + 2, food.y * 14 + 2, 10, 10);\n    // Serpiente\n    snake.forEach((s, i) => {\n        g.fillStyle = i === 0 ? '#10b981' : '#34d399';\n        g.fillRect(s.x * 14 + 1, s.y * 14 + 1, 12, 12);\n    });\n};\n\nconst update = () => {\n    if (!gameActive) return;\n    dx = nextDx; dy = nextDy;\n    if (dx === 0 && dy === 0) return;\n\n    const head = { x: snake[0].x + dx, y: snake[0].y + dy };\n\n    if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20 || snake.some(s => s.x === head.x && s.y === head.y)) {\n        gameActive = false;\n        clearInterval(loop);\n        btnStart.style.display = 'block';\n        btnStart.innerText = \"RETRY\";\n        return;\n    }\n\n    snake.unshift(head);\n    if (head.x === food.x && head.y === food.y) {\n        score += 10;\n        document.getElementById('sk-score').innerText = `PUNTOS: ${score}`;\n        food = { x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20) };\n        if (score % 50 === 0) {\n            level++;\n            document.getElementById('sk-level').innerText = `NIVEL: ${level}`;\n            speed = Math.max(50, speed - 10);\n            clearInterval(loop);\n            loop = setInterval(update, speed);\n        }\n    } else {\n        snake.pop();\n    }\n    draw();\n};\n\nconst setDiff = (d, s, b) => {\n    currentDifficulty = d; speed = s;\n    [easyBtn, normBtn, hardBtn].forEach(btn => { btn.style.background = 'transparent'; btn.style.color = '#718096'; });\n    b.style.background = '#10b981'; b.style.color = '#fff';\n    if (gameActive) btnStart.click();\n};\n\neasyBtn.onclick = () => setDiff('EASY', 200, easyBtn);\nnormBtn.onclick = () => setDiff('NORMAL', 150, normBtn);\nhardBtn.onclick = () => setDiff('HARD', 90, hardBtn);\n\nbtnStart.onclick = () => {\n    snake = [{x: 10, y: 10}]; dx = 0; dy = 0; nextDx = 0; nextDy = 0; score = 0; level = 1;\n    gameActive = true; btnStart.style.display = 'none';\n    document.getElementById('sk-score').innerText = \"PUNTOS: 0\";\n    document.getElementById('sk-level').innerText = \"NIVEL: 1\";\n    clearInterval(loop);\n    loop = setInterval(update, speed);\n};\n\nwindow.onkeydown = (e) => {\n    if (e.key === 'ArrowUp' && dy === 0) { nextDx = 0; nextDy = -1; }\n    if (e.key === 'ArrowDown' && dy === 0) { nextDx = 0; nextDy = 1; }\n    if (e.key === 'ArrowLeft' && dx === 0) { nextDx = -1; nextDy = 0; }\n    if (e.key === 'ArrowRight' && dx === 0) { nextDx = 1; nextDy = 0; }\n};\n\nbody.append(diffSelector, stats, canvas, btnStart);\nwin.append(header, body);\ndocument.body.appendChild(win);\n\n// ARRASTRE\nlet dragging = false, offset = {x:0, y:0};\nheader.onmousedown = (e) => {\n    dragging = true;\n    offset.x = e.clientX - win.offsetLeft;\n    offset.y = e.clientY - win.offsetTop;\n    win.style.zIndex = 10000;\n};\nwindow.addEventListener('mousemove', (e) => {\n    if (!dragging) return;\n    win.style.left = (e.clientX - offset.x) + 'px';\n    win.style.top = (e.clientY - offset.y) + 'px';\n});\nwindow.addEventListener('mouseup', () => dragging = false);\n\ndocument.getElementById(`close-${winId}`).onclick = () => {\n    gameActive = false; clearInterval(loop);\n    win.remove();\n};\n\ndraw();\nreturn \"Snake Pro Iniciado\";\n",
        "_isExternal": false
      },
      {
        "id": "custom-self-exporter-exec-v22",
        "title": "Crear Ejecutable v2.2 (Autoportable)",
        "color": "#ef4444",
        "inputs": [
          "exec"
        ],
        "outputs": [],
        "fields": [
          {
            "name": "filename",
            "type": "text",
            "placeholder": "NombreApp"
          }
        ],
        "code": "\n// --- CREAR EJECUTABLE V2.2 (AUTOPORTABLE) ---\nconst name = ctx.fields.filename || \"App_\" + Date.now();\nctx.log(`‚ö° Procesando ejecutable autoportable: ${name}...`);\n\ntry {\n    // 1. Serializar el grafo actual\n    const fullData = ctx.graph.serialize();\n\n    // 2. EXTRAER DEFINICIONES DE M√ìDULOS USADOS (La \"Portabilidad\")\n    // Identificamos qu√© tipos de nodos hay en el grafo\n    const usedTypes = new Set(fullData.nodes.map(n => n.type));\n    \n    // Filtramos los m√≥dulos personalizados que existen en el sistema y que est√°n en el grafo\n    const embeddedModules = ProgrammerManager.customModules.filter(m => usedTypes.has(m.id));\n    \n    if (embeddedModules.length > 0) {\n        ctx.log(`üì¶ Embebiendo ${embeddedModules.length} m√≥dulos personalizados...`);\n    }\n\n    // 3. CIRUG√çA: Extirpar este mismo nodo exportador para evitar bucles\n    const cleanNodes = fullData.nodes.filter(n => n.id !== ctx.nodeId);\n    const cleanConns = fullData.connections.filter(c => \n        c.fromNode !== ctx.nodeId && c.toNode !== ctx.nodeId\n    );\n\n    // 4. Reconstruir el objeto con las definiciones embebidas\n    const finalContent = {\n        ...fullData,\n        nodes: cleanNodes,\n        connections: cleanConns,\n        embeddedModules: embeddedModules, // <-- AQU√ç VA LA MAGIA\n        panX: 0, panY: 0, scale: 1\n    };\n\n    // 5. Crear el archivo en el Sistema\n    if (typeof FileSystem !== 'undefined') {\n        const newProg = FileSystem.createProgram(name, 'desktop');\n        \n        newProg.type = 'executable'; \n        newProg.icon = 'zap'; \n        newProg.color = 'text-yellow-500';\n        newProg.content = finalContent;\n        \n        FileSystem.save();\n        if (typeof refreshSystemViews === 'function') refreshSystemViews();\n        \n        ctx.log(`‚úÖ ¬°√âxito! \"${name}\" es ahora autoportable.`);\n    } else {\n        ctx.log(\"‚ùå Error: No se encuentra el Sistema de Archivos.\");\n    }\n} catch (e) {\n    ctx.log(\"‚ùå Error: \" + e.message);\n}\n",
        "_isExternal": false
      }
    ]
  },
  "x": 1076,
  "y": 532,
  "icon": "zap",
  "color": "text-yellow-500"
}